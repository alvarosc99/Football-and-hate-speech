---
title: "1 - Train & Test"
author: '100385774'
date: "2023-04-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(data.table)
library(ggplot2)
library(stringr)
library(openxlsx)
library(lubridate)
library(emo)
library(stopwords)
library(tidytext)
library(fastmatch)
```

```{r}

df <- read.xlsx("data/annotationbis.xlsx")

annotation_b <- read.delim("data/HaterNet.txt", sep = ";", col.names = c("id", "X1", "text", "X2", "hate")) %>% 
  select(-c(X1, X2))

annotation_c <- read.delim("data/hateval/hateval2019_es_train.csv", sep = ",") %>% 
  select(-c(TR, AG)) %>% 
  rename(hate = HS) 

```


Noise removal (bots), Boolean mention and URL presence, lower casing, time conversion: 

```{r}
df <- df %>% 
  distinct(text, .keep_all = T) %>% 
  mutate(text = tolower(text),
         entities.mentions = ifelse(str_detect(text, "@.{1,15} "), T, F),
         entities.url = ifelse(str_detect(text, "https://.*\\b"), T, F),
         text = str_remove_all(text, "@.{1,15} "),
         text = str_remove_all(text, "https://.*\\b"))

```

Emojis and laughs tokenization: 

```{r}
df <- df %>% 
  mutate(text = str_replace_all(text, "🏻|🏼|🏽|🏾|🏿", ""),
         text = str_replace_all(text, "\\\\n|&lt", " "), 
         text = str_replace_all(text, "🤣+|😂+", ":risa:"),
         text = str_replace_all(text, "🐀+", ":rata:"),
         text = str_replace_all(text, "😡+|🔪+|🤬+|👊+|🪓+|🤮+|💩+", ":enfado:"),
         text = str_replace_all(text, "👏+|💪+|✊+|💪+|❤️+|🥰+|❤+|🤍+", ":positividad:"),
         text = ji_replace_all(text, ""),
         text = iconv(text, to = "UTF-8//IGNORE"),
         text = str_replace_all(text, "jajaja.*\\.?\\s?|jsjsjs.*\\.?\\s?|jajaj.*\\.?\\s?|jsjsj.*\\.?\\s?|j{1,}a{1,}s{1,}?j{1,}a{1,}s{1,}?.*\\.?\\s?", ":risa: "))

```


Tokenizing: 

```{r}

tidy_df <- df %>% 
  unnest_tokens(word, text)

```

Stopwords removal and lemmatization: 

```{r}
lemmas <- fread("Lemmatizer/200918/spdictionary.csv")

stop <- as.tibble(stopwords("es", source = "nltk")) %>% 
  rename(word = value)

tidy_df %>% 
  anti_join(stop)

tidy_df$word <- ifelse(is.na(match(tidy_df$word, lemmas$word)), tidy_df$word, lemmas$canonical[match(tidy_df$word, lemmas$word)])
  
```




















